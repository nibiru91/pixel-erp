[{"name":"/Query/Select/Select_ricavi_detail_incassato","nodes":[{"id":"f8417b76-50d3-8331-2627-1342f992d501","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\n\n\ntry {\n  \n  // Definizione delle variabili per i filtri e l'ordinamento\n  const var_when_soggetto = Inputs.Var_when_soggetto; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_gestore = Inputs.Var_when_gestore; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_area = Inputs.Var_when_area; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_ticket = Inputs.Var_when_ticket; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_orderby_column = Inputs.Var_orderby_column; // Sostituisci con il nome della colonna per l'ordinamento o lascia vuoto\n  const var_orderby_desc_asc = Inputs.Var_orderby_desc_asc; // Usa 'asc' per ascendente, 'desc' per discendente, o lascia vuoto\n  const dataDal = Inputs.DataDal;\n  const dataAl = Inputs.DataAl;\n\n  // Inizia a costruire la query\n  let queryRicavi = supabase.from('v_ricavi_detail').select('supid:id, date, importo, an_area, an_area_nome, an_tecnologia, an_tecnologia_nome, an_gestore, an_gestore_ragsoc, soggetto, soggetto_ragsoc, an_prodotto, prodotto_nome, portafoglio');\n\n  // Applica la clausola where condizionalmente\n  let matchConditions = { payment_done: true }; // Filtro per visualizzare solo l'incassato\n  if (var_when_area) matchConditions.an_area = var_when_area;\n  if (var_when_ticket) matchConditions.an_tecnologia = var_when_ticket;\n  if (var_when_soggetto) matchConditions.soggetto = var_when_soggetto;\n  if (var_when_gestore) matchConditions.an_gestore = var_when_gestore;\n  queryRicavi = queryRicavi.match(matchConditions);\n  // Applica la clausola order by condizionalmente\n  if (var_orderby_column && var_orderby_desc_asc) {\n    queryRicavi = queryRicavi.order(var_orderby_column, { ascending: var_orderby_desc_asc === 'asc' });\n  }\n\n  // Applica un order by per il mese estratto dalla colonna 'date'\n  queryRicavi = queryRicavi.order('date', { ascending: true });\n  \n  //Applica i filtri date Dal Al condizionalmente\n  if (dataDal) {\n        // Filtra gli eventi a partire da questa data (inclusa)\n        queryRicavi = queryRicavi.gte('date', dataDal);\n    }\n\n    if (dataAl) {\n        // Filtra gli eventi fino a questa data (inclusa)\n        queryRicavi = queryRicavi.lte('date', dataAl);\n    }\n\n  // Esegue la query\n  const { data, error } = await queryRicavi;\n\n// Ricorda di gestire sia `data` che `error`\n\n  if (error) {\n    console.error(error)\n    Outputs.Failure();\n  } else {\n    Outputs.Data = data;\n    Outputs.Totali = data.reduce((acc, curr) => acc + curr.importo, 0);\n    Outputs.Success();\n\n  }\n} catch (error) {\n    console.error(error)\n  Outputs.Failure();\n}"},"ports":[{"name":"in-Var_when_soggetto","displayName":"Var_when_soggetto","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Var_when_gestore","displayName":"Var_when_gestore","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-Var_when_area","displayName":"Var_when_area","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-Var_when_ticket","displayName":"Var_when_ticket","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-Var_orderby_column","displayName":"Var_orderby_column","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-Var_orderby_desc_asc","displayName":"Var_orderby_desc_asc","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-DataDal","displayName":"DataDal","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-DataAl","displayName":"DataAl","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":12},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":13},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":14},{"name":"out-Totali","displayName":"Totali","plug":"output","type":"*","group":"Outputs","index":15}],"children":[]},{"id":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"5d710c9a-c14c-9154-d09e-27e1e7cbe588","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"8505abe8-f86a-73bc-f4e5-b0d47ba629b5","type":"Date To String","parameters":{},"ports":[],"children":[]},{"id":"34d2247d-b1b5-5c52-a9db-290c76127e23","type":"Date To String","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"Run","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"run"},{"sourceId":"f8417b76-50d3-8331-2627-1342f992d501","sourcePort":"out-Success","targetId":"5d710c9a-c14c-9154-d09e-27e1e7cbe588","targetPort":"Success"},{"sourceId":"f8417b76-50d3-8331-2627-1342f992d501","sourcePort":"out-Totali","targetId":"5d710c9a-c14c-9154-d09e-27e1e7cbe588","targetPort":"totale"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"var_when_soggetto","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-Var_when_soggetto"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"var_when_area","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-Var_when_area"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"var_when_ticket","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-Var_when_ticket"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"var_orderby_column","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-Var_orderby_column"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"var_orderby_desc_asc","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-Var_orderby_desc_asc"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"dataDal","targetId":"8505abe8-f86a-73bc-f4e5-b0d47ba629b5","targetPort":"input"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"dataAl","targetId":"34d2247d-b1b5-5c52-a9db-290c76127e23","targetPort":"input"},{"sourceId":"8505abe8-f86a-73bc-f4e5-b0d47ba629b5","sourcePort":"currentValue","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-DataDal"},{"sourceId":"34d2247d-b1b5-5c52-a9db-290c76127e23","sourcePort":"currentValue","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-DataAl"},{"sourceId":"3ebaf959-af8e-7b0d-8980-0b9712111fa9","sourcePort":"var_when_gestore","targetId":"f8417b76-50d3-8331-2627-1342f992d501","targetPort":"in-Var_when_gestore"},{"sourceId":"f8417b76-50d3-8331-2627-1342f992d501","sourcePort":"out-Data","targetId":"5d710c9a-c14c-9154-d09e-27e1e7cbe588","targetPort":"data"}],"ports":[{"name":"data","type":"*","plug":"output","index":1},{"name":"Run","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"Success","type":"signal","plug":"output","index":2},{"name":"var_when_soggetto","type":"*","group":"Inputs","plug":"input","index":2},{"name":"totale","type":"*","plug":"output","index":3},{"name":"var_when_area","type":"*","group":"Inputs","plug":"input","index":3},{"name":"arrayID","type":"*","plug":"output","index":4},{"name":"var_when_ticket","type":"*","group":"Inputs","plug":"input","index":4},{"name":"var_orderby_column","type":"*","group":"Inputs","plug":"input","index":5},{"name":"var_orderby_desc_asc","type":"*","group":"Inputs","plug":"input","index":6},{"name":"dataDal","type":{"name":"date"},"plug":"input","index":7},{"name":"dataAl","type":{"name":"date"},"plug":"input","index":8},{"name":"var_when_gestore","type":"*","group":"Inputs","plug":"input","index":9}],"roots":[]}]