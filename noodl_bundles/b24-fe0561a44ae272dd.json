[{"name":"/ForzaVendite","nodes":[{"id":"d30c3c5b-a312-ea52-1c0e-b891a7ca69c9","type":"Page","parameters":{},"ports":[],"children":[{"id":"2b356841-4975-f7da-5972-90ca2af8c55e","type":"Group","parameters":{"scrollEnabled":false,"clip":false,"sizeMode":"explicit"},"ports":[],"children":[{"id":"a1eecca5-69b8-d687-5ab0-c4ca72830986","type":"/Dashboards/DashMain_forzaVendite","parameters":{},"ports":[],"children":[]}]}]},{"id":"b639018d-8473-92d3-2f58-4ea6144f605f","type":"PageInputs","parameters":{},"ports":[],"children":[]},{"id":"ba6474d4-d9b0-7917-6d07-e0533dd22cdb","type":"JavaScriptFunction","parameters":{"functionScript":"if (!Inputs.Profile) {\n    Outputs.LogOut()\n} else {\n    const profile = Inputs.Profile;\n    const isAdmin = Inputs.Profile.is_admin;\n    if (isAdmin) {\n        Outputs.Admin();\n    } else { Outputs.Venditore(); }\n}"},"ports":[{"name":"in-Profile","displayName":"Profile","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-LogOut","displayName":"LogOut","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Admin","displayName":"Admin","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Venditore","displayName":"Venditore","plug":"output","type":"signal","group":"Outputs","index":7}],"children":[]},{"id":"5991ff4d-4654-0373-2541-dd1d97939319","type":"Model2","parameters":{"modelId":"currentUser","properties":"profile"},"ports":[],"children":[]},{"id":"133c2517-f528-dd4a-ba79-eedaa2e7a3b8","type":"RouterNavigate","parameters":{"router":"Supabase Not Logged In Router","target":"/#Supabase Prefab/Supabase Prefab/Pages/Log in"},"ports":[],"children":[]}],"connections":[{"sourceId":"5991ff4d-4654-0373-2541-dd1d97939319","sourcePort":"prop-profile","targetId":"ba6474d4-d9b0-7917-6d07-e0533dd22cdb","targetPort":"in-Profile"},{"sourceId":"d30c3c5b-a312-ea52-1c0e-b891a7ca69c9","sourcePort":"didMount","targetId":"ba6474d4-d9b0-7917-6d07-e0533dd22cdb","targetPort":"run"},{"sourceId":"ba6474d4-d9b0-7917-6d07-e0533dd22cdb","sourcePort":"out-LogOut","targetId":"133c2517-f528-dd4a-ba79-eedaa2e7a3b8","targetPort":"navigate"}],"ports":[],"roots":["d30c3c5b-a312-ea52-1c0e-b891a7ca69c9"]},{"name":"/Dashboards/DashMain_forzaVendite","nodes":[{"id":"179a4f1b-b697-41f6-b583-9c92bddb88d8","type":"Group","parameters":{"sizeMode":"explicit","width":{"value":100,"unit":"%"},"height":{"value":100,"unit":"%"}},"ports":[],"children":[{"id":"b567c058-b3bf-6e7b-4b53-1b10a90efed0","type":"Group","parameters":{},"ports":[],"children":[{"id":"117bb16e-307e-2b2e-4a4d-86e33d8aac8a","type":"Group","parameters":{"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"},"sizeMode":"contentHeight"},"ports":[],"children":[{"id":"30ae2735-a9e1-e9ee-821e-6dcedb504d3e","type":"Group","parameters":{},"ports":[],"children":[{"id":"8a7622fc-ffbc-5ef3-cdbd-553237f9605f","type":"Group","parameters":{"flexDirection":"row","sizeMode":"contentHeight"},"ports":[],"children":[{"id":"9f58bfb6-1f81-a681-7a80-da666735fa0f","type":"net.noodl.controls.options","parameters":{"items":"[\n    {\"Label\":\"nessun filtro\", \"Value\":\"\"},\n    {\"Label\":\"high-ticket\", \"Value\":\"1\"},\n    {\"Label\":\"mid-ticket\", \"Value\":\"2\"},\n    {\"Label\":\"low-ticket\", \"Value\":\"3\"}\n]","label":"Ramo B.U.","marginBottom":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"}},"ports":[],"children":[]},{"id":"c19fdf0b-9858-518b-eda7-8c80b79ffb92","type":"net.noodl.controls.options","parameters":{"items":"[\n    {\"Label\":\"nessun filtro\", \"Value\":\"\"},\n    {\"Label\":\"online\", \"Value\":\"1\"},\n    {\"Label\":\"diretta\", \"Value\":\"2\"}\n]","label":"Business Unit","marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[]}]},{"id":"3c1f8964-8eaa-9c2b-863e-239b04fed3b3","type":"net.noodl.controls.options","parameters":{"label":"Venditore","marginBottom":{"value":16,"unit":"px"},"items":"[]"},"ports":[],"children":[]},{"id":"435c5dcc-2c40-aa42-f70a-df034d774031","type":"Group","parameters":{"flexDirection":"row","marginRight":{"value":16,"unit":"px"},"sizeMode":"contentHeight"},"ports":[],"children":[{"id":"3a217416-00a4-a593-09d0-8f98528ebcd3","type":"/Components/Date Picker","parameters":{"Show Label":true,"Label":"Data DAL","Margin Bottom":{"value":16,"unit":"px"},"Margin Right":{"value":16,"unit":"px"}},"ports":[],"children":[]},{"id":"cd7866c0-4a4c-263f-8a43-ff6560181b72","type":"/Components/Date Picker","parameters":{"Show Label":true,"Label":"Data AL","Margin Bottom":{"value":16,"unit":"px"}},"ports":[],"children":[]}]}]},{"id":"8de52567-16ed-82c8-d13a-d2988432c449","type":"Group","parameters":{"flexDirection":"row","justifyContent":"center","marginTop":{"value":50,"unit":"px"},"marginBottom":{"value":50,"unit":"px"}},"ports":[],"children":[{"id":"4da7de3f-4004-cf97-19f9-225af49745a3","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":150,"unit":"px"},"height":{"value":50,"unit":"px"},"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[{"id":"2101acfd-1a83-3f79-5990-f4b3bd2f7a8c","type":"Text","parameters":{"text":"Fatturato","textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Black.ttf","color":"Success","fontSize":{"value":24,"unit":"px"}},"ports":[],"children":[]},{"id":"2ee4e131-ee1b-7677-0782-d65bed15011a","type":"Text","parameters":{"textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Light.ttf","fontSize":{"value":20,"unit":"px"}},"ports":[],"children":[]}]},{"id":"9f554245-bfdf-e3bb-de4f-18eeb08fa89a","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":150,"unit":"px"},"height":{"value":50,"unit":"px"},"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[{"id":"93ccce5d-ef66-b57b-78f1-21aa316aab62","type":"Text","parameters":{"text":"Fees Totali","textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Black.ttf","color":"Notice","fontSize":{"value":24,"unit":"px"}},"ports":[],"children":[]},{"id":"9b94a38a-b76b-7a25-17c6-c6481f8fd00d","type":"Text","parameters":{"textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Light.ttf","fontSize":{"value":20,"unit":"px"}},"ports":[],"children":[]}]},{"id":"bf0a8725-5d3f-880c-ee3e-77dc1144efe9","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":150,"unit":"px"},"height":{"value":50,"unit":"px"},"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[{"id":"770508f0-5066-d8ae-0412-cd13f6526518","type":"Text","parameters":{"text":"Venditore","textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Black.ttf","color":"Primary Dark","fontSize":{"value":24,"unit":"px"}},"ports":[],"children":[]},{"id":"4c253ccd-f9fe-af53-4f43-835cb277bf97","type":"Text","parameters":{"textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Light.ttf","fontSize":{"value":20,"unit":"px"}},"ports":[],"children":[]}]},{"id":"ed037c5a-806c-c948-f447-a28a5f520316","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":150,"unit":"px"},"height":{"value":50,"unit":"px"},"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[{"id":"1f7e8705-14fb-7e8b-3762-17d2689313c5","type":"Text","parameters":{"text":"Setter","textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Black.ttf","color":"Primary Dark","fontSize":{"value":24,"unit":"px"}},"ports":[],"children":[]},{"id":"6ab9ec68-4942-d44c-5e16-a450381ee1bc","type":"Text","parameters":{"textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Light.ttf","fontSize":{"value":20,"unit":"px"}},"ports":[],"children":[]}]},{"id":"5f9114d2-5cc9-ab5e-dbb9-679331e76ef6","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":150,"unit":"px"},"height":{"value":50,"unit":"px"},"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[{"id":"b681bbe9-55e5-7c92-696f-3813cf3f5d31","type":"Text","parameters":{"text":"Sales Coach","textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Black.ttf","color":"Primary Dark","fontSize":{"value":24,"unit":"px"}},"ports":[],"children":[]},{"id":"c07f9340-b1b4-a1ed-1285-a86995f50141","type":"Text","parameters":{"textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Light.ttf","fontSize":{"value":20,"unit":"px"}},"ports":[],"children":[]}]},{"id":"401f6876-c011-d39d-8449-72540f5f8fd1","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":150,"unit":"px"},"height":{"value":50,"unit":"px"},"marginLeft":{"value":16,"unit":"px"},"marginTop":{"value":16,"unit":"px"},"marginRight":{"value":16,"unit":"px"},"marginBottom":{"value":16,"unit":"px"}},"ports":[],"children":[{"id":"f6739997-0844-1316-557f-b503eb04eecd","type":"Text","parameters":{"text":"Lead Gen","textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Black.ttf","color":"Primary Dark","fontSize":{"value":24,"unit":"px"}},"ports":[],"children":[]},{"id":"c3693e69-5656-f5b1-5aa1-c36ee5610f01","type":"Text","parameters":{"textAlignX":"center","fontFamily":"fonts/Roboto/Roboto-Light.ttf","fontSize":{"value":20,"unit":"px"}},"ports":[],"children":[]}]}]},{"id":"17d5f364-39f8-d09d-4993-1f99f68293ac","type":"Group","parameters":{"sizeMode":"explicit","height":{"value":500,"unit":"px"},"alignItems":"center"},"ports":[],"children":[{"id":"4fd6c616-9e88-bd90-c719-48e2a1b72ab9","type":"net.noodl.controls.checkbox","parameters":{"label":"Grafico Giornaliero"},"ports":[],"children":[]},{"id":"768951b4-29da-7fc1-e96c-7e6709a1b274","type":"Line Chart","parameters":{},"ports":[],"children":[]}]}]}]}]},{"id":"9951ac01-26f3-988d-486b-787db8a75199","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\n\n\ntry {\n  \n  const { data, error } = await supabase\n        .from('def_an_tecnologia')\n        .select('id, nome');\n\n    if (error) {\n    console.error(error)\n    Outputs.Failure();\n    }\n    \n    else {\n    // Trasforma i risultati in un formato { Label, Value }\n    const transformedData = data.map(tecnologia => ({\n        Value: tecnologia.id.toString(),\n        Label: tecnologia.nome\n    }));\n\n    //return transformedData;\n\n    Outputs.Data = data;\n    Outputs.TransformedData = transformedData;\n    Outputs.Success();\n\n  }\n} \n  catch (error) {\n    console.error(error)\n    Outputs.Failure();\n  }"},"ports":[{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":6},{"name":"out-TransformedData","displayName":"TransformedData","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"7cc35771-63f0-1dc8-c0f6-234ac229f4fb","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\n\n\ntry {\n  \n  const { data, error } = await supabase\n        .from('def_an_area')\n        .select('id, nome');\n\n    if (error) {\n    console.error(error)\n    Outputs.Failure();\n    }\n    \n    else {\n    // Trasforma i risultati in un formato { Label, Value }\n    const transformedData = data.map(area => ({\n        Value: area.id.toString(),\n        Label: area.nome\n    }));\n\n    //return transformedData;\n\n    Outputs.Data = data;\n    Outputs.TransformedData = transformedData;\n    Outputs.Success();\n\n  }\n} \n  catch (error) {\n    console.error(error)\n    Outputs.Failure();\n  }"},"ports":[{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":6},{"name":"out-TransformedData","displayName":"TransformedData","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"88a59e66-6f28-d44a-1bc8-970a6978ae25","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"a89491bc-deca-f983-366f-571a3df28adc","type":"JavaScriptFunction","parameters":{"functionScript":"ricavi = Inputs.ricavi;\n\n// Mappiamo i ricavi per diminuire le dimensioni del dataset ai soli dati utili, che sono già filtrati\nlet ricaviModificati = ricavi.map(item => {\n    return {\n        data: item.date,\n        importo: item.importo,\n    };\n});\n\nOutputs.ricavi = ricaviModificati;\nOutputs.Success();\n\n"},"ports":[{"name":"in-ricavi","displayName":"ricavi","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-ricavi","displayName":"ricavi","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"d032b2c8-28d7-d8a1-c429-b0aa933cd03d","type":"Collection2","parameters":{},"ports":[],"children":[]},{"id":"7ac39b77-dfd9-64a0-877d-f3c180f18e46","type":"Event Receiver","parameters":{"consume":"always","channelName":"FetchPayment"},"ports":[],"children":[]},{"id":"01f2252f-127f-375c-b6f9-2740d41f68f7","type":"/Query/Select/Select Dati Venditori","parameters":{},"ports":[],"children":[]},{"id":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","type":"/Query/Select/Select_ricavi_fees","parameters":{},"ports":[],"children":[]},{"id":"67221b0d-ac22-d530-65d7-de9782f2f799","type":"Expression","parameters":{"expression":"feesTotali.toFixed(2) + \" (\" + ((feesTotali/fatturato)*100).toFixed(2) + \"%)\""},"ports":[],"children":[]},{"id":"0556e185-7220-b0f5-621b-e17eca519613","type":"Expression","parameters":{"expression":"fatturato.toFixed(2)"},"ports":[],"children":[]},{"id":"ec90c0ca-6b32-137b-94c3-95645b90d54d","type":"Expression","parameters":{"expression":"feesVenditore.toFixed(2)  + \" (\" + ((feesVenditore/fatturato)*100).toFixed(2) + \"%)\""},"ports":[],"children":[]},{"id":"15ad29d4-5fc7-f211-c2ca-fa3f71fa90e8","type":"Expression","parameters":{"expression":"feesSetter.toFixed(2) + \" (\" + ((feesSetter/fatturato)*100).toFixed(2) + \"%)\""},"ports":[],"children":[]},{"id":"fe4861fc-fb2a-275d-1e95-8798c1ef9c63","type":"Expression","parameters":{"expression":"feesSalescoach.toFixed(2) + \" (\" + ((feesSalescoach/fatturato)*100).toFixed(2) + \"%)\""},"ports":[],"children":[]},{"id":"f0257580-d9ff-9c39-82cc-c0e3c4b9ef8f","type":"Expression","parameters":{"expression":"feesLeadgen.toFixed(2) + \" (\" + ((feesLeadgen/fatturato)*100).toFixed(2) + \"%)\""},"ports":[],"children":[]},{"id":"652370ce-e648-77fd-621d-8669f001401e","type":"JavaScriptFunction","parameters":{"functionScript":"Outputs.ID = parseInt(Inputs.ID);\n\nOutputs.Success();\n\n"},"ports":[{"name":"in-ID","displayName":"ID","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-ID","displayName":"ID","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"57ca688a-0efb-95ba-480e-b7c805c6ac9b","type":"JavaScriptFunction","parameters":{"functionScript":"Outputs.ID = parseInt(Inputs.ID);\n\nOutputs.Success();\n\n"},"ports":[{"name":"in-ID","displayName":"ID","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-ID","displayName":"ID","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"84298acb-91dc-5eaa-2a93-8c895169a751","type":"JavaScriptFunction","parameters":{"functionScript":"Outputs.ID = parseInt(Inputs.ID);\n\nOutputs.Success();\n\n"},"ports":[{"name":"in-ID","displayName":"ID","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-ID","displayName":"ID","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","type":"JavaScriptFunction","parameters":{"functionScript":"// Recupera i dati dagli input\nconst array = Inputs.Ricavi;\nconst isGiornaliero = Inputs.Giornaliero;\n\n// Oggetto per tenere traccia degli importi aggregati per periodo\nconst totaliRaggruppati = {};\n\n// Raggruppa i dati in base al valore di `isGiornaliero`\nif (isGiornaliero) {\n    // Aggrega gli importi per giorno\n    array.forEach(item => {\n        const giorno = item.data; // Estrae l'intera data (giorno, mese, anno)\n        if (totaliRaggruppati[giorno]) {\n            totaliRaggruppati[giorno] += item.importo;\n        } else {\n            totaliRaggruppati[giorno] = item.importo;\n        }\n    });\n} else {\n    // Aggrega gli importi per mese\n    array.forEach(item => {\n        const mese = item.data.substring(0, 7); // Estrae solo anno e mese dalla data (es. 2024-04)\n        if (totaliRaggruppati[mese]) {\n            totaliRaggruppati[mese] += item.importo;\n        } else {\n            totaliRaggruppati[mese] = item.importo;\n        }\n    });\n}\n\n// Ottieni le etichette dei periodi e i dati degli importi\nconst labels = Object.keys(totaliRaggruppati).sort(); // Ordina le etichette in ordine crescente\nconst data = Object.values(totaliRaggruppati); // Ottieni gli importi aggregati\n\n// Prepara i dati per Chart.js\nconst datiGrafico = {\n    labels,\n    datasets: [\n        {\n            label: isGiornaliero ? 'Totali Giornalieri' : 'Totali Mensili',\n            data: data,\n            borderColor: 'blue',\n            backgroundColor: 'blue',\n        }\n    ]\n};\n\nOutputs.Data = datiGrafico;\n\nconst config = {\n    y: {\n        grid: {\n            zeroLineWidth: 3,\n            zeroLineColor: 'rgba(0, 0, 0, 1)',\n            drawBorder: true,\n            color: function (context) {\n                if (context.tick.value === 0) {\n                    return 'rgba(0, 0, 0, 1)';  // Colore per la linea dello zero\n                }\n                return 'rgba(0, 0, 0, 0.1)';  // Colore per le altre linee della griglia\n            }\n        }\n    }\n};\n\nOutputs.YAxis = config;\n"},"ports":[{"name":"in-Ricavi","displayName":"Ricavi","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Giornaliero","displayName":"Giornaliero","plug":"input","type":"*","group":"Inputs","index":5},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":6},{"name":"out-YAxis","displayName":"YAxis","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]}],"connections":[{"sourceId":"117bb16e-307e-2b2e-4a4d-86e33d8aac8a","sourcePort":"didMount","targetId":"9951ac01-26f3-988d-486b-787db8a75199","targetPort":"run"},{"sourceId":"9951ac01-26f3-988d-486b-787db8a75199","sourcePort":"out-TransformedData","targetId":"9f58bfb6-1f81-a681-7a80-da666735fa0f","targetPort":"items"},{"sourceId":"7cc35771-63f0-1dc8-c0f6-234ac229f4fb","sourcePort":"out-TransformedData","targetId":"c19fdf0b-9858-518b-eda7-8c80b79ffb92","targetPort":"items"},{"sourceId":"117bb16e-307e-2b2e-4a4d-86e33d8aac8a","sourcePort":"didMount","targetId":"7cc35771-63f0-1dc8-c0f6-234ac229f4fb","targetPort":"run"},{"sourceId":"01f2252f-127f-375c-b6f9-2740d41f68f7","sourcePort":"list","targetId":"3c1f8964-8eaa-9c2b-863e-239b04fed3b3","targetPort":"items"},{"sourceId":"3a217416-00a4-a593-09d0-8f98528ebcd3","sourcePort":"Changed","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"3a217416-00a4-a593-09d0-8f98528ebcd3","sourcePort":"Value","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"dataDal"},{"sourceId":"cd7866c0-4a4c-263f-8a43-ff6560181b72","sourcePort":"Changed","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"cd7866c0-4a4c-263f-8a43-ff6560181b72","sourcePort":"Value","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"dataAl"},{"sourceId":"01f2252f-127f-375c-b6f9-2740d41f68f7","sourcePort":"Success","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"feesTotali","targetId":"67221b0d-ac22-d530-65d7-de9782f2f799","targetPort":"feesTotali"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"fatturato","targetId":"67221b0d-ac22-d530-65d7-de9782f2f799","targetPort":"fatturato"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"Success","targetId":"67221b0d-ac22-d530-65d7-de9782f2f799","targetPort":"run"},{"sourceId":"67221b0d-ac22-d530-65d7-de9782f2f799","sourcePort":"result","targetId":"9b94a38a-b76b-7a25-17c6-c6481f8fd00d","targetPort":"text"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"fatturato","targetId":"0556e185-7220-b0f5-621b-e17eca519613","targetPort":"fatturato"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"Success","targetId":"0556e185-7220-b0f5-621b-e17eca519613","targetPort":"run"},{"sourceId":"0556e185-7220-b0f5-621b-e17eca519613","sourcePort":"result","targetId":"2ee4e131-ee1b-7677-0782-d65bed15011a","targetPort":"text"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"Success","targetId":"ec90c0ca-6b32-137b-94c3-95645b90d54d","targetPort":"run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"feesVenditore","targetId":"ec90c0ca-6b32-137b-94c3-95645b90d54d","targetPort":"feesVenditore"},{"sourceId":"ec90c0ca-6b32-137b-94c3-95645b90d54d","sourcePort":"result","targetId":"4c253ccd-f9fe-af53-4f43-835cb277bf97","targetPort":"text"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"Success","targetId":"15ad29d4-5fc7-f211-c2ca-fa3f71fa90e8","targetPort":"run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"feesSetter","targetId":"15ad29d4-5fc7-f211-c2ca-fa3f71fa90e8","targetPort":"feesSetter"},{"sourceId":"15ad29d4-5fc7-f211-c2ca-fa3f71fa90e8","sourcePort":"result","targetId":"6ab9ec68-4942-d44c-5e16-a450381ee1bc","targetPort":"text"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"Success","targetId":"fe4861fc-fb2a-275d-1e95-8798c1ef9c63","targetPort":"run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"feesSalescoach","targetId":"fe4861fc-fb2a-275d-1e95-8798c1ef9c63","targetPort":"feesSalescoach"},{"sourceId":"fe4861fc-fb2a-275d-1e95-8798c1ef9c63","sourcePort":"result","targetId":"c07f9340-b1b4-a1ed-1285-a86995f50141","targetPort":"text"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"Success","targetId":"f0257580-d9ff-9c39-82cc-c0e3c4b9ef8f","targetPort":"run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"feesLeadgen","targetId":"f0257580-d9ff-9c39-82cc-c0e3c4b9ef8f","targetPort":"feesLeadgen"},{"sourceId":"f0257580-d9ff-9c39-82cc-c0e3c4b9ef8f","sourcePort":"result","targetId":"c3693e69-5656-f5b1-5aa1-c36ee5610f01","targetPort":"text"},{"sourceId":"3c1f8964-8eaa-9c2b-863e-239b04fed3b3","sourcePort":"value","targetId":"652370ce-e648-77fd-621d-8669f001401e","targetPort":"in-ID"},{"sourceId":"652370ce-e648-77fd-621d-8669f001401e","sourcePort":"out-ID","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"var_when_gestore"},{"sourceId":"652370ce-e648-77fd-621d-8669f001401e","sourcePort":"out-Success","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"3c1f8964-8eaa-9c2b-863e-239b04fed3b3","sourcePort":"onChange","targetId":"652370ce-e648-77fd-621d-8669f001401e","targetPort":"run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"fatturato","targetId":"ec90c0ca-6b32-137b-94c3-95645b90d54d","targetPort":"fatturato"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"fatturato","targetId":"15ad29d4-5fc7-f211-c2ca-fa3f71fa90e8","targetPort":"fatturato"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"fatturato","targetId":"fe4861fc-fb2a-275d-1e95-8798c1ef9c63","targetPort":"fatturato"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"fatturato","targetId":"f0257580-d9ff-9c39-82cc-c0e3c4b9ef8f","targetPort":"fatturato"},{"sourceId":"9f58bfb6-1f81-a681-7a80-da666735fa0f","sourcePort":"onChange","targetId":"57ca688a-0efb-95ba-480e-b7c805c6ac9b","targetPort":"run"},{"sourceId":"9f58bfb6-1f81-a681-7a80-da666735fa0f","sourcePort":"value","targetId":"57ca688a-0efb-95ba-480e-b7c805c6ac9b","targetPort":"in-ID"},{"sourceId":"57ca688a-0efb-95ba-480e-b7c805c6ac9b","sourcePort":"out-Success","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"57ca688a-0efb-95ba-480e-b7c805c6ac9b","sourcePort":"out-ID","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"var_when_ticket"},{"sourceId":"c19fdf0b-9858-518b-eda7-8c80b79ffb92","sourcePort":"onChange","targetId":"84298acb-91dc-5eaa-2a93-8c895169a751","targetPort":"run"},{"sourceId":"c19fdf0b-9858-518b-eda7-8c80b79ffb92","sourcePort":"value","targetId":"84298acb-91dc-5eaa-2a93-8c895169a751","targetPort":"in-ID"},{"sourceId":"84298acb-91dc-5eaa-2a93-8c895169a751","sourcePort":"out-Success","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"84298acb-91dc-5eaa-2a93-8c895169a751","sourcePort":"out-ID","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"var_when_area"},{"sourceId":"7ac39b77-dfd9-64a0-877d-f3c180f18e46","sourcePort":"eventReceived","targetId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","targetPort":"Run"},{"sourceId":"117bb16e-307e-2b2e-4a4d-86e33d8aac8a","sourcePort":"didMount","targetId":"01f2252f-127f-375c-b6f9-2740d41f68f7","targetPort":"Run"},{"sourceId":"a89491bc-deca-f983-366f-571a3df28adc","sourcePort":"out-Success","targetId":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","targetPort":"run"},{"sourceId":"a89491bc-deca-f983-366f-571a3df28adc","sourcePort":"out-ricavi","targetId":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","targetPort":"in-Ricavi"},{"sourceId":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","sourcePort":"out-Data","targetId":"768951b4-29da-7fc1-e96c-7e6709a1b274","targetPort":"data"},{"sourceId":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","sourcePort":"out-YAxis","targetId":"768951b4-29da-7fc1-e96c-7e6709a1b274","targetPort":"scales"},{"sourceId":"4fd6c616-9e88-bd90-c719-48e2a1b72ab9","sourcePort":"checked","targetId":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","targetPort":"in-Giornaliero"},{"sourceId":"4fd6c616-9e88-bd90-c719-48e2a1b72ab9","sourcePort":"onChange","targetId":"f4becec6-a719-a049-0c04-60aa7a1a4b3f","targetPort":"run"},{"sourceId":"30c789d3-73ca-d2f0-9b72-dd9af64022f3","sourcePort":"data","targetId":"d032b2c8-28d7-d8a1-c429-b0aa933cd03d","targetPort":"items"},{"sourceId":"d032b2c8-28d7-d8a1-c429-b0aa933cd03d","sourcePort":"items","targetId":"a89491bc-deca-f983-366f-571a3df28adc","targetPort":"in-ricavi"},{"sourceId":"d032b2c8-28d7-d8a1-c429-b0aa933cd03d","sourcePort":"changed","targetId":"a89491bc-deca-f983-366f-571a3df28adc","targetPort":"run"}],"ports":[{"name":"Run","type":"*","plug":"input","index":1}],"roots":["179a4f1b-b697-41f6-b583-9c92bddb88d8"]},{"name":"/Query/Select/Select Dati Venditori","nodes":[{"id":"b9e60ca4-9570-4ec8-238d-322b9f66e52b","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"1c2037b0-7774-1685-9115-181a90b69254","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\ntry {\n\n  let supid = Inputs.Supid;\n  \n  let query = supabase\n  .from('soggetti')\n  .select('supid:id, ragione_sociale, fisso_mensile, fees_model');\n\n  // Applica la clausola where condizionalmente\n  let matchConditions = { tipo: 2, is_venditore: true }; \n  if (supid) matchConditions.id = supid;\n  \n  query = query.match(matchConditions);\n\n  const { data, error } = await query;\n\n  if (error) {\n  console.error(error)\n  Outputs.Failure();\n  }\n  \n  else {\n  // Trasforma i risultati in un formato { Label, Value }\n  const listData = data.map(soggetto => ({\n      Value: soggetto.supid.toString(),\n      Label: soggetto.ragione_sociale\n    }));\n\n  //valorizza gli Outputs;\n  Outputs.Data = data;\n  Outputs.FirstRowID = data[0].supid;\n  Outputs.ListData = listData;\n  Outputs.Success();\n  \n  }\n}\n\n  catch (error) {\n    console.error(error)\n    Outputs.Failure();\n  }"},"ports":[{"name":"in-Supid","displayName":"Supid","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":7},{"name":"out-FirstRowID","displayName":"FirstRowID","plug":"output","type":"*","group":"Outputs","index":8},{"name":"out-ListData","displayName":"ListData","plug":"output","type":"*","group":"Outputs","index":9}],"children":[]}],"connections":[{"sourceId":"b9e60ca4-9570-4ec8-238d-322b9f66e52b","sourcePort":"Run","targetId":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","targetPort":"run"},{"sourceId":"b9e60ca4-9570-4ec8-238d-322b9f66e52b","sourcePort":"IDVenditore","targetId":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","targetPort":"in-Supid"},{"sourceId":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","sourcePort":"out-Success","targetId":"1c2037b0-7774-1685-9115-181a90b69254","targetPort":"Success"},{"sourceId":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","sourcePort":"out-Data","targetId":"1c2037b0-7774-1685-9115-181a90b69254","targetPort":"data"},{"sourceId":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","sourcePort":"out-ListData","targetId":"1c2037b0-7774-1685-9115-181a90b69254","targetPort":"list"},{"sourceId":"6b5ccc65-849d-3c7d-3547-c76fe6b541f5","sourcePort":"out-FirstRowID","targetId":"1c2037b0-7774-1685-9115-181a90b69254","targetPort":"firstRowID"}],"ports":[{"name":"data","type":"*","plug":"output","index":1},{"name":"Run","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"Success","type":"signal","plug":"output","index":2},{"name":"IDVenditore","type":"*","group":"Inputs","plug":"input","index":2},{"name":"list","type":"*","plug":"output","index":3},{"name":"firstRowID","type":"*","plug":"output","index":4}],"roots":[]},{"name":"/Query/Select/Select_ricavi_fees","nodes":[{"id":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) {\n    console.error('Supabase client not found');\n    Outputs.Failure();\n    return;\n}\n\n(async () => {\n    try {\n        // Definizione delle variabili per i filtri e l'ordinamento\n        const var_when_soggetto = Inputs.Var_when_soggetto;\n        const var_when_gestore = Inputs.Var_when_gestore;\n        const var_when_area = Inputs.Var_when_area;\n        const var_when_ticket = Inputs.Var_when_ticket;\n        const var_orderby_column = Inputs.Var_orderby_column;\n        const var_orderby_desc_asc = Inputs.Var_orderby_desc_asc;\n        const dataDal = Inputs.DataDal;\n        const dataAl = Inputs.DataAl;\n\n        // Inizia a costruire la query\n        let queryRicavi = supabase\n            .from('v_ricavi_fees')\n            .select('supid:id, date, importo, an_area, an_area_nome, an_tecnologia, an_tecnologia_nome, an_gestore, an_gestore_ragsoc, fees_gestore, soggetto, soggetto_ragsoc, an_prodotto, prodotto_nome, an_setter, fees_setter, an_salescoach, fees_salescoach, an_leadgen, fees_leadgen');\n\n        // Applica la clausola `where` condizionalmente\n        const matchConditions = {};\n        if (var_when_area) matchConditions.an_area = var_when_area;\n        if (var_when_ticket) matchConditions.an_tecnologia = var_when_ticket;\n        if (var_when_soggetto) matchConditions.soggetto = var_when_soggetto;\n        if (var_when_gestore) matchConditions.an_gestore = var_when_gestore;\n\n        queryRicavi = queryRicavi.match(matchConditions);\n\n        // Applica la clausola `order by` condizionalmente\n        if (var_orderby_column && var_orderby_desc_asc) {\n            queryRicavi = queryRicavi.order(var_orderby_column, { ascending: var_orderby_desc_asc === 'asc' });\n        }\n\n        // Applica un `order by` per la colonna 'date'\n        queryRicavi = queryRicavi.order('date', { ascending: true });\n\n        // Applica i filtri `dataDal` e `dataAl` condizionalmente\n        if (dataDal) {\n            queryRicavi = queryRicavi.gte('date', dataDal);\n        }\n\n        if (dataAl) {\n            queryRicavi = queryRicavi.lte('date', dataAl);\n        }\n\n        // Esegue la query\n        const { data, error } = await queryRicavi;\n\n        if (error) {\n            console.error(error);\n            Outputs.Failure();\n        } else {\n            Outputs.Data = data;\n\n            // Calcola il fatturato\n            const fatturato = data.reduce((acc, curr) => acc + (curr.importo || 0), 0);\n\n            let feesGestore, feesSetter, feesSalescoach, feesLeadgen;\n            if (var_when_gestore) {\n                // Filtra le fee per gestore specifico\n                feesGestore = data.filter(row => row.an_gestore === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_gestore || 0), 0);\n                feesSetter = data.filter(row => row.an_setter === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_setter || 0), 0);\n                feesSalescoach = data.filter(row => row.an_salescoach === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_salescoach || 0), 0);\n                feesLeadgen = data.filter(row => row.an_leadgen === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_leadgen || 0), 0);\n            } else {\n                // Calcola le fee totali senza filtro per gestore\n                feesGestore = data.reduce((acc, curr) => acc + (curr.fees_gestore || 0), 0);\n                feesSetter = data.reduce((acc, curr) => acc + (curr.fees_setter || 0), 0);\n                feesSalescoach = data.reduce((acc, curr) => acc + (curr.fees_salescoach || 0), 0);\n                feesLeadgen = data.reduce((acc, curr) => acc + (curr.fees_leadgen || 0), 0);\n            }\n\n            const feesTotali = feesGestore + feesSetter + feesSalescoach + feesLeadgen;\n\n            // Assegna gli output\n            Outputs.Fatturato = fatturato;\n            Outputs.FeesVenditore = feesGestore;\n            Outputs.FeesSetter = feesSetter;\n            Outputs.FeesSalescoach = feesSalescoach;\n            Outputs.FeesLeadgen = feesLeadgen;\n            Outputs.FeesTotali = feesTotali;\n            Outputs.Success();\n        }\n    } catch (error) {\n        console.error(error);\n        Outputs.Failure();\n    }\n})();\n"},"ports":[{"name":"in-Var_when_soggetto","displayName":"Var_when_soggetto","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Var_when_gestore","displayName":"Var_when_gestore","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-Var_when_area","displayName":"Var_when_area","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-Var_when_ticket","displayName":"Var_when_ticket","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-Var_orderby_column","displayName":"Var_orderby_column","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-Var_orderby_desc_asc","displayName":"Var_orderby_desc_asc","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-DataDal","displayName":"DataDal","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-DataAl","displayName":"DataAl","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":12},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":13},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":14},{"name":"out-Fatturato","displayName":"Fatturato","plug":"output","type":"*","group":"Outputs","index":15},{"name":"out-FeesVenditore","displayName":"FeesVenditore","plug":"output","type":"*","group":"Outputs","index":16},{"name":"out-FeesSetter","displayName":"FeesSetter","plug":"output","type":"*","group":"Outputs","index":17},{"name":"out-FeesSalescoach","displayName":"FeesSalescoach","plug":"output","type":"*","group":"Outputs","index":18},{"name":"out-FeesLeadgen","displayName":"FeesLeadgen","plug":"output","type":"*","group":"Outputs","index":19},{"name":"out-FeesTotali","displayName":"FeesTotali","plug":"output","type":"*","group":"Outputs","index":20}],"children":[]},{"id":"6746620a-bd49-d956-2fff-ae521a258419","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"5e321984-f4ec-d7a3-83ec-8c9fede7a939","type":"Date To String","parameters":{},"ports":[],"children":[]},{"id":"8ee8d99c-56a5-1b4d-f8b6-75d4b5b3f14d","type":"Date To String","parameters":{},"ports":[],"children":[]},{"id":"055e312b-d2c2-151e-61a9-05e74a85bd31","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\n\n\ntry {\n  \n  // Definizione delle variabili per i filtri e l'ordinamento\n  const var_when_soggetto = Inputs.Var_when_soggetto; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_gestore = Inputs.Var_when_gestore; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_area = Inputs.Var_when_area; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_ticket = Inputs.Var_when_ticket; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_orderby_column = Inputs.Var_orderby_column; // Sostituisci con il nome della colonna per l'ordinamento o lascia vuoto\n  const var_orderby_desc_asc = Inputs.Var_orderby_desc_asc; // Usa 'asc' per ascendente, 'desc' per discendente, o lascia vuoto\n  const dataDal = Inputs.DataDal;\n  const dataAl = Inputs.DataAl;\n\n  // Inizia a costruire la query\n  let queryRicavi = supabase.from('v_ricavi_fees').select('supid:id, date, importo, an_area, an_area_nome, an_tecnologia, an_tecnologia_nome, an_gestore, an_gestore_ragsoc, fees_gestore, soggetto, soggetto_ragsoc, an_prodotto, prodotto_nome, an_setter, fees_setter, an_salescoach, fees_salescoach, an_leadgen, fees_leadgen');\n\n  // Applica la clausola where condizionalmente\n  let matchConditions = {};  //vengono estratte sia le righe saldate che le righe non saldate\n  if (var_when_area) matchConditions.an_area = var_when_area;\n  if (var_when_ticket) matchConditions.an_tecnologia = var_when_ticket;\n  if (var_when_soggetto) matchConditions.soggetto = var_when_soggetto;\n  if (var_when_gestore) matchConditions.an_gestore = var_when_gestore;\n  queryRicavi = queryRicavi.match(matchConditions);\n  // Applica la clausola order by condizionalmente\n  if (var_orderby_column && var_orderby_desc_asc) {\n    queryRicavi = queryRicavi.order(var_orderby_column, { ascending: var_orderby_desc_asc === 'asc' });\n  }\n\n  // Applica un order by per il mese estratto dalla colonna 'date'\n  queryRicavi = queryRicavi.order('date', { ascending: true });\n  \n  //Applica i filtri date Dal Al condizionalmente\n  if (dataDal) {\n        // Filtra gli eventi a partire da questa data (inclusa)\n        queryRicavi = queryRicavi.gte('date', dataDal);\n    }\n\n    if (dataAl) {\n        // Filtra gli eventi fino a questa data (inclusa)\n        queryRicavi = queryRicavi.lte('date', dataAl);\n    }\n\n  // Esegue la query\n  const { data, error } = await queryRicavi;\n\n// Ricorda di gestire sia `data` che `error`\n\n  if (error) {\n    console.error(error)\n    Outputs.Failure();\n  } else {\n    Outputs.Data = data;\n    Outputs.Fatturato = data.reduce((acc, curr) => acc + curr.importo, 0);\n    Outputs.FeesVenditore = data.reduce((acc, curr) => acc + curr.fees_gestore, 0);\n    Outputs.FeesSetter = data.reduce((acc, curr) => acc + curr.fees_setter, 0);\n    Outputs.FeesSalescoach = data.reduce((acc, curr) => acc + curr.fees_salescoach, 0);\n    Outputs.FeesLeadgen = data.reduce((acc, curr) => acc + curr.fees_leadgen, 0);\n    Outputs.FeesTotali = Outputs.FeesVenditore + Outputs.FeesSetter + Outputs.FeesSalescoach + Outputs.FeesLeadgen;\n    Outputs.Success();\n\n  }\n} catch (error) {\n    console.error(error)\n  Outputs.Failure();\n}"},"ports":[{"name":"in-Var_when_soggetto","displayName":"Var_when_soggetto","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Var_when_gestore","displayName":"Var_when_gestore","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-Var_when_area","displayName":"Var_when_area","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-Var_when_ticket","displayName":"Var_when_ticket","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-Var_orderby_column","displayName":"Var_orderby_column","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-Var_orderby_desc_asc","displayName":"Var_orderby_desc_asc","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-DataDal","displayName":"DataDal","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-DataAl","displayName":"DataAl","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":12},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":13},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":14},{"name":"out-Fatturato","displayName":"Fatturato","plug":"output","type":"*","group":"Outputs","index":15},{"name":"out-FeesVenditore","displayName":"FeesVenditore","plug":"output","type":"*","group":"Outputs","index":16},{"name":"out-FeesSetter","displayName":"FeesSetter","plug":"output","type":"*","group":"Outputs","index":17},{"name":"out-FeesSalescoach","displayName":"FeesSalescoach","plug":"output","type":"*","group":"Outputs","index":18},{"name":"out-FeesLeadgen","displayName":"FeesLeadgen","plug":"output","type":"*","group":"Outputs","index":19},{"name":"out-FeesTotali","displayName":"FeesTotali","plug":"output","type":"*","group":"Outputs","index":20}],"children":[]},{"id":"d58cce98-9742-9566-179c-1a6994af5731","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\n\n\ntry {\n  \n  // Definizione delle variabili per i filtri e l'ordinamento\n  const var_when_soggetto = Inputs.Var_when_soggetto; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_gestore = Inputs.Var_when_gestore; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_area = Inputs.Var_when_area; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_ticket = Inputs.Var_when_ticket; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_orderby_column = Inputs.Var_orderby_column; // Sostituisci con il nome della colonna per l'ordinamento o lascia vuoto\n  const var_orderby_desc_asc = Inputs.Var_orderby_desc_asc; // Usa 'asc' per ascendente, 'desc' per discendente, o lascia vuoto\n  const dataDal = Inputs.DataDal;\n  const dataAl = Inputs.DataAl;\n\n  // Inizia a costruire la query\n  let queryRicavi = supabase.from('v_ricavi_fees').select('supid:id, date, importo, an_area, an_area_nome, an_tecnologia, an_tecnologia_nome, an_gestore, an_gestore_ragsoc, fees_gestore, soggetto, soggetto_ragsoc, an_prodotto, prodotto_nome, an_setter, fees_setter, an_salescoach, fees_salescoach, an_leadgen, fees_leadgen');\n\n  // Applica la clausola where condizionalmente\n  let matchConditions = {};  //vengono estratte sia le righe saldate che le righe non saldate\n  if (var_when_area) matchConditions.an_area = var_when_area;\n  if (var_when_ticket) matchConditions.an_tecnologia = var_when_ticket;\n  if (var_when_soggetto) matchConditions.soggetto = var_when_soggetto;\n  if (var_when_gestore) matchConditions.an_gestore = var_when_gestore;\n  queryRicavi = queryRicavi.match(matchConditions);\n  // Applica la clausola order by condizionalmente\n  if (var_orderby_column && var_orderby_desc_asc) {\n    queryRicavi = queryRicavi.order(var_orderby_column, { ascending: var_orderby_desc_asc === 'asc' });\n  }\n\n  // Applica un order by per il mese estratto dalla colonna 'date'\n  queryRicavi = queryRicavi.order('date', { ascending: true });\n  \n  //Applica i filtri date Dal Al condizionalmente\n  if (dataDal) {\n        // Filtra gli eventi a partire da questa data (inclusa)\n        queryRicavi = queryRicavi.gte('date', dataDal);\n    }\n\n    if (dataAl) {\n        // Filtra gli eventi fino a questa data (inclusa)\n        queryRicavi = queryRicavi.lte('date', dataAl);\n    }\n\n  // Esegue la query\n  const { data, error } = await queryRicavi;\n\n// Ricorda di gestire sia `data` che `error`\n\n  if (error) {\n    console.error(error)\n    Outputs.Failure();\n  } else {\n    Outputs.Data = data;\n    //queste variabili inerenti le fees verificano ogni singola riga in base al gestore inserito nei filtri\n    const fatturato = data.reduce((acc, curr) => acc + (curr.importo || 0), 0);\n    const feesGestore = data.filter(row => row.an_gestore === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_gestore || 0), 0);\n    const feesSetter = data.filter(row => row.an_setter === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_setter || 0), 0);\n    const feesSalescoach = data.filter(row => row.an_salescoach === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_salescoach || 0), 0);\n    const feesLeadgen = data.filter(row => row.an_leadgen === var_when_gestore).reduce((acc, curr) => acc + (curr.fees_leadgen || 0), 0);\n    const feesTotali = feesGestore + feesSetter + feesSalescoach + feesLeadgen;\n\n    Outputs.Fatturato = fatturato;\n    Outputs.FeesVenditore = feesGestore;\n    Outputs.FeesSetter = feesSetter;\n    Outputs.FeesSalescoach = feesSalescoach;\n    Outputs.FeesLeadgen = feesLeadgen;\n    Outputs.FeesTotali = feesTotali;\n    /*\n    Outputs.Fatturato = data.reduce((acc, curr) => acc + curr.importo, 0);\n    Outputs.FeesVenditore = data.reduce((acc, curr) => acc + curr.fees_gestore, 0);\n    Outputs.FeesSetter = data.reduce((acc, curr) => acc + curr.fees_setter, 0);\n    Outputs.FeesSalescoach = data.reduce((acc, curr) => acc + curr.fees_salescoach, 0);\n    Outputs.FeesLeadgen = data.reduce((acc, curr) => acc + curr.fees_leadgen, 0);\n    Outputs.FeesTotali = Outputs.FeesVenditore + Outputs.FeesSetter + Outputs.FeesSalescoach + Outputs.FeesLeadgen;\n    */\n    Outputs.Success();\n\n  }\n} catch (error) {\n    console.error(error)\n  Outputs.Failure();\n}"},"ports":[{"name":"in-Var_when_soggetto","displayName":"Var_when_soggetto","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Var_when_gestore","displayName":"Var_when_gestore","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-Var_when_area","displayName":"Var_when_area","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-Var_when_ticket","displayName":"Var_when_ticket","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-Var_orderby_column","displayName":"Var_orderby_column","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-Var_orderby_desc_asc","displayName":"Var_orderby_desc_asc","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-DataDal","displayName":"DataDal","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-DataAl","displayName":"DataAl","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":12},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":13},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":14},{"name":"out-Fatturato","displayName":"Fatturato","plug":"output","type":"*","group":"Outputs","index":15},{"name":"out-FeesVenditore","displayName":"FeesVenditore","plug":"output","type":"*","group":"Outputs","index":16},{"name":"out-FeesSetter","displayName":"FeesSetter","plug":"output","type":"*","group":"Outputs","index":17},{"name":"out-FeesSalescoach","displayName":"FeesSalescoach","plug":"output","type":"*","group":"Outputs","index":18},{"name":"out-FeesLeadgen","displayName":"FeesLeadgen","plug":"output","type":"*","group":"Outputs","index":19},{"name":"out-FeesTotali","displayName":"FeesTotali","plug":"output","type":"*","group":"Outputs","index":20}],"children":[]}],"connections":[{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"Run","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"run"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-Success","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"Success"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"var_when_soggetto","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-Var_when_soggetto"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"var_when_area","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-Var_when_area"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"var_when_ticket","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-Var_when_ticket"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"var_orderby_column","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-Var_orderby_column"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"var_orderby_desc_asc","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-Var_orderby_desc_asc"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"dataDal","targetId":"5e321984-f4ec-d7a3-83ec-8c9fede7a939","targetPort":"input"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"dataAl","targetId":"8ee8d99c-56a5-1b4d-f8b6-75d4b5b3f14d","targetPort":"input"},{"sourceId":"5e321984-f4ec-d7a3-83ec-8c9fede7a939","sourcePort":"currentValue","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-DataDal"},{"sourceId":"8ee8d99c-56a5-1b4d-f8b6-75d4b5b3f14d","sourcePort":"currentValue","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-DataAl"},{"sourceId":"6746620a-bd49-d956-2fff-ae521a258419","sourcePort":"var_when_gestore","targetId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","targetPort":"in-Var_when_gestore"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-Data","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"data"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-Fatturato","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"fatturato"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-FeesVenditore","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"feesVenditore"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-FeesSetter","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"feesSetter"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-FeesSalescoach","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"feesSalescoach"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-FeesLeadgen","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"feesLeadgen"},{"sourceId":"0135f675-c9a9-a3a7-1bcf-ea6033f79adf","sourcePort":"out-FeesTotali","targetId":"c0c92a4c-a750-ab62-fd4e-f8dfeeab09d4","targetPort":"feesTotali"}],"ports":[{"name":"data","type":"*","plug":"output","index":1},{"name":"Run","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"Success","type":"signal","plug":"output","index":2},{"name":"var_when_soggetto","type":"*","group":"Inputs","plug":"input","index":2},{"name":"feesVenditore","type":"*","plug":"output","index":3},{"name":"var_when_area","type":"*","group":"Inputs","plug":"input","index":3},{"name":"feesSetter","type":"*","plug":"output","index":4},{"name":"var_when_ticket","type":"*","group":"Inputs","plug":"input","index":4},{"name":"feesSalescoach","type":"*","plug":"output","index":5},{"name":"var_orderby_column","type":"*","group":"Inputs","plug":"input","index":5},{"name":"feesLeadgen","type":"*","plug":"output","index":6},{"name":"var_orderby_desc_asc","type":"*","group":"Inputs","plug":"input","index":6},{"name":"fatturato","type":"*","plug":"output","index":7},{"name":"dataDal","type":{"name":"date"},"plug":"input","index":7},{"name":"feesTotali","type":"*","plug":"output","index":8},{"name":"dataAl","type":{"name":"date"},"plug":"input","index":8},{"name":"var_when_gestore","type":"*","group":"Inputs","plug":"input","index":9}],"roots":[]}]