[{"name":"/Query/Select/Select_ricavi_noPayment","nodes":[{"id":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","type":"JavaScriptFunction","parameters":{"functionScript":"const supabase = Noodl.Variables.supabase;\n\nif (!supabase) throw new Error('Supabase client not found');\n\n\n\ntry {\n  \n  // Definizione delle variabili per i filtri e l'ordinamento\n  const var_when_soggetto = Inputs.Var_when_soggetto; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_gestore = Inputs.Var_when_gestore; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_area = Inputs.Var_when_area; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_when_ticket = Inputs.Var_when_ticket; // Sostituisci con il valore desiderato o lascia vuoto\n  const var_orderby_column = Inputs.Var_orderby_column; // Sostituisci con il nome della colonna per l'ordinamento o lascia vuoto\n  const var_orderby_desc_asc = Inputs.Var_orderby_desc_asc; // Usa 'asc' per ascendente, 'desc' per discendente, o lascia vuoto\n  const dataDal = Inputs.DataDal;\n  const dataAl = Inputs.DataAl;\n\n  // Inizia a costruire la query\n  let queryRicavi = supabase.from('v_ricavi_detail').select('supid:id, date, importo, an_area, an_area_nome, an_tecnologia, an_tecnologia_nome, an_gestore, an_gestore_ragsoc, soggetto, soggetto_ragsoc, an_prodotto, prodotto_nome, portafoglio');\n\n  // Applica la clausola where condizionalmente\n  let matchConditions = { payment_done: false }; // Filtro per visualizzare solo l'incassato\n  if (var_when_area) matchConditions.an_area = var_when_area;\n  if (var_when_ticket) matchConditions.an_tecnologia = var_when_ticket;\n  if (var_when_soggetto) matchConditions.soggetto = var_when_soggetto;\n  if (var_when_gestore) matchConditions.an_gestore = var_when_gestore;\n  queryRicavi = queryRicavi.match(matchConditions);\n  // Applica la clausola order by condizionalmente\n  if (var_orderby_column && var_orderby_desc_asc) {\n    queryRicavi = queryRicavi.order(var_orderby_column, { ascending: var_orderby_desc_asc === 'asc' });\n  }\n\n  // Applica un order by per il mese estratto dalla colonna 'date'\n  queryRicavi = queryRicavi.order('date', { ascending: true });\n\n  //Applica i filtri date Dal Al condizionalmente\n  if (dataDal) {\n        // Filtra gli eventi a partire da questa data (inclusa)\n        queryRicavi = queryRicavi.gte('date', dataDal);\n    }\n\n    if (dataAl) {\n        // Filtra gli eventi fino a questa data (inclusa)\n        queryRicavi = queryRicavi.lte('date', dataAl);\n    }\n\n  // Esegue la query\n  const { data, error } = await queryRicavi;\n\n// Ricorda di gestire sia `data` che `error`\n\n  if (error) {\n    console.error(error)\n    Outputs.Failure();\n  } else {\n    Outputs.Data = data;\n    Outputs.Totali = data.reduce((acc, curr) => acc + curr.importo, 0);\n    Outputs.Success();\n\n  }\n} catch (error) {\n    console.error(error)\n  Outputs.Failure();\n}"},"ports":[{"name":"in-Var_when_soggetto","displayName":"Var_when_soggetto","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-Var_when_gestore","displayName":"Var_when_gestore","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-Var_when_area","displayName":"Var_when_area","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-Var_when_ticket","displayName":"Var_when_ticket","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-Var_orderby_column","displayName":"Var_orderby_column","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-Var_orderby_desc_asc","displayName":"Var_orderby_desc_asc","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-DataDal","displayName":"DataDal","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-DataAl","displayName":"DataAl","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":12},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":13},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":14},{"name":"out-Totali","displayName":"Totali","plug":"output","type":"*","group":"Outputs","index":15}],"children":[]},{"id":"840f9976-fd24-b11d-a60e-36ef375c1e9e","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"93a6e2d1-41b8-ed89-fba9-48d0cb471cd0","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"c70844bb-31f1-9b40-e6c2-1e2b447b536c","type":"Date To String","parameters":{},"ports":[],"children":[]},{"id":"39dc73a8-6a31-9bde-00b5-25435ed37c8a","type":"Date To String","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"Run","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"run"},{"sourceId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","sourcePort":"out-Success","targetId":"93a6e2d1-41b8-ed89-fba9-48d0cb471cd0","targetPort":"Success"},{"sourceId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","sourcePort":"out-Totali","targetId":"93a6e2d1-41b8-ed89-fba9-48d0cb471cd0","targetPort":"totale"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"var_when_soggetto","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-Var_when_soggetto"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"var_when_area","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-Var_when_area"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"var_when_ticket","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-Var_when_ticket"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"var_orderby_column","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-Var_orderby_column"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"var_orderby_desc_asc","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-Var_orderby_desc_asc"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"dataDal","targetId":"c70844bb-31f1-9b40-e6c2-1e2b447b536c","targetPort":"input"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"dataAl","targetId":"39dc73a8-6a31-9bde-00b5-25435ed37c8a","targetPort":"input"},{"sourceId":"c70844bb-31f1-9b40-e6c2-1e2b447b536c","sourcePort":"currentValue","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-DataDal"},{"sourceId":"39dc73a8-6a31-9bde-00b5-25435ed37c8a","sourcePort":"currentValue","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-DataAl"},{"sourceId":"840f9976-fd24-b11d-a60e-36ef375c1e9e","sourcePort":"var_when_gestore","targetId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","targetPort":"in-Var_when_gestore"},{"sourceId":"91264a7b-4d39-c6f4-4bdd-b2fbf084c881","sourcePort":"out-Data","targetId":"93a6e2d1-41b8-ed89-fba9-48d0cb471cd0","targetPort":"data"}],"ports":[{"name":"data","type":"*","plug":"output","index":1},{"name":"Run","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"Success","type":"signal","plug":"output","index":2},{"name":"var_when_soggetto","type":"*","group":"Inputs","plug":"input","index":2},{"name":"totale","type":"*","plug":"output","index":3},{"name":"var_when_area","type":"*","group":"Inputs","plug":"input","index":3},{"name":"arrayID","type":"*","plug":"output","index":4},{"name":"var_when_ticket","type":"*","group":"Inputs","plug":"input","index":4},{"name":"var_orderby_column","type":"*","group":"Inputs","plug":"input","index":5},{"name":"var_orderby_desc_asc","type":"*","group":"Inputs","plug":"input","index":6},{"name":"dataDal","type":{"name":"date"},"plug":"input","index":7},{"name":"dataAl","type":{"name":"date"},"plug":"input","index":8},{"name":"var_when_gestore","type":"*","group":"Inputs","plug":"input","index":9}],"roots":[]}]